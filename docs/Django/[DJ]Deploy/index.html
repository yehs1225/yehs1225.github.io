<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Yeh&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Yeh&#39;s blog Atom Feed"><title data-react-helmet="true">Deploy | Yeh&#x27;s blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/Django/[DJ]Deploy"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Deploy | Yeh&#x27;s blog"><meta data-react-helmet="true" name="description" content="Fundamentals of Deployment"><meta data-react-helmet="true" property="og:description" content="Fundamentals of Deployment"><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/Django/[DJ]Deploy"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Django/[DJ]Deploy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Django/[DJ]Deploy" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f2b17ad4.css">
<link rel="preload" href="/assets/js/runtime~main.b71e95a1.js" as="script">
<link rel="preload" href="/assets/js/main.9865ff2e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/favicon.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yehs1225" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Notes Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Algorithm/Algorithm[1]">Algorithm</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/BasicKnowlege/CSS-RWD切版練習">BasicKnowlege</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/DataStructures/Graph">DataStructures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/Django/[DJ]Deploy">Django</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Django/[DJ]Deploy">Deploy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/[DJ]GetStarted-documents">GetStarted-documents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/[DJ]GetStartedBuildCRM[1]">GetStarted - build CRM [1]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/[DJ]GetStartedBuildCRM[2]">GetStarted - build CRM [2]</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/[DJ]PackagesAndTools">Packages And Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/[DJ]RestFramework">Rest Framework</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Docker/Docker1基本介紹">Docker</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/JavaScript/JavaScript-this">JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Reactjs/React_ES6">Reactjs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Tools/Command-Line-and-Vim">Tools</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Deploy</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="fundamentals-of-deployment">Fundamentals of Deployment<a class="hash-link" href="#fundamentals-of-deployment" title="Direct link to heading">​</a></h2><p>許多現代的網頁開發技術都有相似的部署過程，不論是Django、Ruby on Rails 、ExpressJS，都有些設定是類似的。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="modern-deployment">Modern Deployment<a class="hash-link" href="#modern-deployment" title="Direct link to heading">​</a></h3><p>現在的部署有許多直接可以透過連接你的GitHub帳號存取特定repository來進行。多數時候甚至只需要設定一些選項、輸入環境變數（environment variables）、輸入指令（build commands）等等就可以完成。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="servers">Servers<a class="hash-link" href="#servers" title="Direct link to heading">​</a></h3><p>Server就是世界上的另一台電腦，網路就是讓一堆電腦能夠互相溝通。當你部署了你的web app後，就可以接收處理來自web上的請求。</p><p>在很久以前，如果要部署web app需要自己架設一台主機，不僅需要公司自派人員管理，甚至也會因為主機壞掉而造成網頁無法使用。</p><p>現在有很多提供雲端服務的公司像是AWS、Digital Ocean、GCP等等。變成只需要付出相對較少的資金成本就可以取得穩定的服務。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="database">Database<a class="hash-link" href="#database" title="Direct link to heading">​</a></h3><p>有許多資料庫種類，像是PostgreSQL、MySQL、MongoDB等等，資料庫是部署很重要的一部分，尤其在安全性，設定只能讓特定使用者、應用存取等等。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="deploying-on-a-separate-server">Deploying on a separate server<a class="hash-link" href="#deploying-on-a-separate-server" title="Direct link to heading">​</a></h5><p><a href="https://www.digitalocean.com/community/questions/when-do-you-move-your-database-to-a-separate-server" target="_blank" rel="noopener noreferrer">When do you move your database to a separate server? | DigitalOcean</a></p><p>較多的分析可參考這篇，然而最主要的優點是 <strong>可提高安全性</strong>，缺點則是 <strong>可能造成延遲</strong>。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="static-and-media-files">Static and Media Files<a class="hash-link" href="#static-and-media-files" title="Direct link to heading">​</a></h3><ul><li>static file : CSS、JavaScript、Images</li><li>media file : 網頁使用者所上傳的文件</li></ul><p>這些文件都需要被存取在某些可被web app找到的地方，有一些方法可以達成：</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="django-deployment-checklist">Django Deployment checklist<a class="hash-link" href="#django-deployment-checklist" title="Direct link to heading">​</a></h3><p><a href="https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/" target="_blank" rel="noopener noreferrer">Deployment checklist | Django documentation | Django (djangoproject.com)</a></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="docker-for-python">Docker （for python）<a class="hash-link" href="#docker-for-python" title="Direct link to heading">​</a></h2><p><a href="https://docs.docker.com/language/python/" target="_blank" rel="noopener noreferrer">Docker Documentation</a>	Follow 文件設定就好!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="dockerfile">Dockerfile<a class="hash-link" href="#dockerfile" title="Direct link to heading">​</a></h3><p><code>Dockerfile</code>是以文字為腳本（script）來創造容器的映象檔。</p><p>其中的設定和其註解</p><div class="codeBlockContainer_I0IT language-dockerfile theme-code-block"><div class="codeBlockContent_wNvx dockerfile"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># syntax=docker/dockerfile:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Syntax should be the first line in Dockerfiles.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#&quot;docker/dockerfile:1&quot; points to the latest release of the version 1 syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#What base image we would like to use </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM python:3.8-slim-buster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Set default location for all subsequent commands.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WORKDIR /app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Copy the required packages into our image and it&#x27;s also named requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY requirements.txt requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Install the packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN pip3 install -r requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Copy everything in the current directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#since we are caching, this command must after COPY requirements.txt requirements.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY . . </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#Run all the arguments in the list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMD [ &quot;python3&quot;, &quot;-m&quot; , &quot;flask&quot;, &quot;run&quot;, &quot;--host=0.0.0.0&quot;]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="docker-compose">Docker compose<a class="hash-link" href="#docker-compose" title="Direct link to heading">​</a></h3><p>用在設定有多個app的container，一般來說我們都會有多個app，像是django+postgreSQL。要使用的話必須設定<code>docker.compose.yml</code>，在範例中長這樣：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">version: &#x27;3.8&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> web:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   context: .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 8000:5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - ./:/app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> mysqldb:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  image: mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ports:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - 3306:3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - MYSQL_ROOT_PASSWORD=p@ssw0rd1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - mysql:/var/lib/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - mysql_config:/etc/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mysql:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mysql_config:</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="cookiecutter-with-docker">Cookiecutter （with Docker）<a class="hash-link" href="#cookiecutter-with-docker" title="Direct link to heading">​</a></h2><p>在Packages And Tools那篇筆記有講到Cookiecutter，而這裡就是再加上Docker設定，可以看到裡面加上了.yml檔案。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="caprover">CapRover<a class="hash-link" href="#caprover" title="Direct link to heading">​</a></h2><p>CapRover 是被 Docker 包裝起來，提供圖形化介面讓我們可以一鍵設定各種工具的後台。</p><p>需要有Domain name、server。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="設定caprover">設定CapRover<a class="hash-link" href="#設定caprover" title="Direct link to heading">​</a></h3><ol><li>Digital Ocean建立新的project</li><li>新增Droplet（ Linux-based virtual machines (VMs) that run on top of virtualized hardware. ）<ol><li>在market place中可以找到caprover</li><li>設定完成後開啟VScode terminal輸入<code>$ssh root@IP_Address</code>（IP_Address 在剛剛建立好的droplet中）</li></ol></li></ol><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">PS C:</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">Users</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">TzuHsuanYeh</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">caprover-test</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> root@206.189.37.133</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The authenticity of </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;206.189.37.133 (206.189.37.133)&#x27;</span><span class="token plain"> can</span><span class="token string" style="color:#e3116c">&#x27;t be established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">ECDSA key fingerprint is SHA256:9obzCFHzIWXf9pgumBXx6ER9iOTLdN0vQNNcrOTJwJQ.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">Warning: Permanently added &#x27;</span><span class="token number" style="color:#36acaa">206.189</span><span class="token plain">.37.133</span><span class="token string" style="color:#e3116c">&#x27; (ECDSA) to the list of known hosts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">root@206.189.37.133&#x27;</span><span class="token plain">s password: </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to Ubuntu </span><span class="token number" style="color:#36acaa">18.04</span><span class="token plain">.6 LTS </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">GNU/Linux </span><span class="token number" style="color:#36acaa">4.15</span><span class="token plain">.0-159-generic x86_64</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Documentation:  https://help.ubuntu.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Management:     https://landscape.canonical.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Support:        https://ubuntu.com/advantage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System information as of Sat Mar </span><span class="token number" style="color:#36acaa">19</span><span class="token plain"> 06:11:41 UTC </span><span class="token number" style="color:#36acaa">2022</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  System load:                    </span><span class="token number" style="color:#36acaa">0.08</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Usage of /:                     </span><span class="token number" style="color:#36acaa">22.4</span><span class="token plain">% of </span><span class="token number" style="color:#36acaa">24</span><span class="token plain">.06GB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Memory usage:                   </span><span class="token number" style="color:#36acaa">29</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Swap usage:                     </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Processes:                      </span><span class="token number" style="color:#36acaa">106</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Users logged in:                </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IP address </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> eth0:            </span><span class="token number" style="color:#36acaa">206.189</span><span class="token plain">.37.133</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IP address </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> eth1:            </span><span class="token number" style="color:#36acaa">10.104</span><span class="token plain">.0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IP address </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> docker0:         </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  IP address </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> docker_gwbridge: </span><span class="token number" style="color:#36acaa">172.18</span><span class="token plain">.0.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">25</span><span class="token plain"> updates can be applied immediately.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To see these additional updates run: </span><span class="token function" style="color:#d73a49">apt</span><span class="token plain"> list --upgradable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*** System restart required ***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to CapRover, Open Source PaaS </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> developers</span><span class="token operator" style="color:#393A34">!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Follow the guide here to finish the setup https://caprover.com/docs/get-started.html</span><span class="token comment" style="color:#999988;font-style:italic">#step-3-install-caprover-cli</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Or you can access the dashboard from http://206.189.37.133:3000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The default password is captain42</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> sure to </span><span class="token builtin class-name">read</span><span class="token plain"> the documentation https://CapRover.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>之後可以到他提供的</p><ul><li>documents :  <a href="https://caprover.com/docs/get-started.html#step-3-install-caprover-cli" target="_blank" rel="noopener noreferrer">https://caprover.com/docs/get-started.html#step-3-install-caprover-cli</a></li><li>dashboard : <code>Or you can access the dashboard from http://206.189.37.133:3000</code></li></ul><p>按照指示，我們可以將設定subdomain（在此設為<code>*.captain.yehs1225.com</code>），並將IP為指向此caprover dashboard （206.189.37.133），接者</p><ul><li><p>下載<code>caprover</code>CLI指令 : <code>$npm install -g caprover</code></p></li><li><p>在CLI設定 : <code>$caprover serversetup</code></p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">root@caprover-test:~</span><span class="token comment" style="color:#999988;font-style:italic"># caprover serversetup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setup CapRover machine on your server</span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? have you already started CapRover container on your server? Yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? IP address of your server: </span><span class="token number" style="color:#36acaa">206.189</span><span class="token plain">.37.133</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? CapRover server root domain: captain.yehs1225.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? new CapRover password </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">min </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> characters</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">hidden</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? enter new CapRover password again: </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">hidden</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? </span><span class="token string" style="color:#e3116c">&quot;valid&quot;</span><span class="token plain"> email address to get certificate and </span><span class="token builtin class-name">enable</span><span class="token plain"> HTTPS: yeh.mentos@gmail.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">? CapRover machine name, with whom the login credentials are stored locally: caprover-example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CapRover server setup completed: it is available as caprover-example at https://captain.captain.yehs1225.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">For </span><span class="token function" style="color:#d73a49">more</span><span class="token plain"> details and docs see CapRover.com</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><p>​		設定完成後就可以該網址去查看管理你的caprover了!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="建立app">建立App<a class="hash-link" href="#建立app" title="Direct link to heading">​</a></h3><p>首先我們在app頁面新增一個叫做django的app，並嘗試將以cookiecutter建立的一個project部署在這裡。</p><p>VSCode Termianl</p><ol><li><p><code>$pip install -r requirements/local.txt</code> ， <code>-r</code> 意思為 Install from the given requirements file.</p><p>會出現安裝<code>psycopg2</code>的錯誤，我們在development時可以先將其改成<code>psycopg2-binary</code></p></li><li><p><code>$python merge_production_dotenvs_in_dotenv.py</code></p></li><li><p>將<code>.env</code>中的key、value貼到caprover app 中的環境變數中</p></li><li><p>在根目錄建立<a href="https://caprover.com/docs/captain-definition-file.html" target="_blank" rel="noopener noreferrer">Captain Definition File</a>（是<code>.json</code>裡面可以做些設定）</p><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx json"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;schemaVersion&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;dockerfilePath&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./compose/production/django/Dockerfile&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><code>$caprover deploy</code></p><p>在此之前，要先<code>$git init</code>。也要記得登入<code>$caprover login</code></p></li><li><p>deploy完成後可以在管理頁面上看到在等待postgres資料庫連線，因為我們還沒建立</p></li><li><p>在app頁面中新增一個one-click db 選擇postgres</p><p>設定完成後會出現</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Postgres is deployed and available as srv-captain--postgres-db:5432 to other apps. For example with NodeJS: &#x27;const client = new Client({ user: &#x27;cap_pg_user&#x27;, host: &#x27;srv-captain--postgres&#x27;, database: &#x27;cap_pg_db&#x27;, password: &#x27;********&#x27;, port: 5432})&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>srv-captain--postgres-db</code>是internal name，方便我們讓其他app存取</p></li><li><p>設定django app的configs中關於postgres的資訊</p></li><li><p>NGINX 502 Error :/        </p><p><a href="https://caprover.com/docs/troubleshooting.html" target="_blank" rel="noopener noreferrer">Troubleshooting · CapRover</a></p><ol><li><p>compose/production/django/start</p><p>加上 <code>python /app/manage.py migrate</code></p><p>修改port<code>/usr/local/bin/gunicorn config.wsgi --bind 0.0.0.0:80 --chdir=/app</code></p><p>（在caprover http settings 可看到Container HTTP Port=80）</p></li><li><p>compose/production/django/Dockerfile</p><p>將<code>ENTRYPOINT [&quot;/entrypoint&quot;]</code>改成<code>CMD [&quot;/start&quot;]</code></p></li><li><p>DATABASE_URL</p><p>在config/production.py中的<code>DATABASES[&quot;default&quot;] = env.db(&quot;DATABASE_URL&quot;)</code>可知DATABASE_URL是必要的參數，本來應該是在.env中新增</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DATABASE_URL </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> postgres://</span><span class="token variable" style="color:#36acaa">$user</span><span class="token builtin class-name">:</span><span class="token variable" style="color:#36acaa">$password</span><span class="token plain">@</span><span class="token variable" style="color:#36acaa">$host</span><span class="token plain">/</span><span class="token variable" style="color:#36acaa">$dbname</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>但我們要到caprover dashboard / app configs設定</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DATABASE_URL = postgres://postgresuser:postgrespassword@srv-captain--postgres-db:5432/postgresdb</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>因為目前沒有用AWS所以會出現錯誤，在這裡為了練習先將compose/production/django/start中的<code>python /app/manage.py collectstatic --noinput</code>註解掉</p></li></ol></li><li><p>如果要改domain name</p><ul><li>在digital ocean（我管理DNS的地方），新增一個type=CNAME、HOSTNAME=@、DIRECT TO=剛剛的網址。</li><li>並在caprover http settings將網址導向正確網址（這裡是yehs1225.com）</li></ul></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="結語">結語<a class="hash-link" href="#結語" title="Direct link to heading">​</a></h3><p>耶!!!CapRover不僅使我們方便部署，設定變數、DB變得很方便（之前單純用Digital Ocean簡直太累人了QQ），更重要的是更便宜了!!!因為依照剛才的模式，我們僅需在Digital Ocean建立一個droplet及一個DB就可以有非常多個App!!!!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yehs1225/yehs1225.github.io/docs/Django/[DJ]Deploy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/DataStructures/Tree"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tree</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Django/[DJ]GetStarted-documents"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">GetStarted-documents</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#fundamentals-of-deployment" class="table-of-contents__link toc-highlight">Fundamentals of Deployment</a><ul><li><a href="#modern-deployment" class="table-of-contents__link toc-highlight">Modern Deployment</a></li><li><a href="#servers" class="table-of-contents__link toc-highlight">Servers</a></li><li><a href="#database" class="table-of-contents__link toc-highlight">Database</a></li><li><a href="#static-and-media-files" class="table-of-contents__link toc-highlight">Static and Media Files</a></li><li><a href="#django-deployment-checklist" class="table-of-contents__link toc-highlight">Django Deployment checklist</a></li></ul></li><li><a href="#docker-for-python" class="table-of-contents__link toc-highlight">Docker （for python）</a><ul><li><a href="#dockerfile" class="table-of-contents__link toc-highlight">Dockerfile</a></li><li><a href="#docker-compose" class="table-of-contents__link toc-highlight">Docker compose</a></li></ul></li><li><a href="#cookiecutter-with-docker" class="table-of-contents__link toc-highlight">Cookiecutter （with Docker）</a></li><li><a href="#caprover" class="table-of-contents__link toc-highlight">CapRover</a><ul><li><a href="#設定caprover" class="table-of-contents__link toc-highlight">設定CapRover</a></li><li><a href="#建立app" class="table-of-contents__link toc-highlight">建立App</a></li><li><a href="#結語" class="table-of-contents__link toc-highlight">結語</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Tzu Hsuan Yeh. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b71e95a1.js"></script>
<script src="/assets/js/main.9865ff2e.js"></script>
</body>
</html>