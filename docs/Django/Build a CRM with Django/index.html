<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Yeh&#39;s blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Yeh&#39;s blog Atom Feed"><title data-react-helmet="true">Build a CRM with Django | Yeh&#x27;s blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/docs/Django/Build a CRM with Django"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Build a CRM with Django | Yeh&#x27;s blog"><meta data-react-helmet="true" name="description" content="Link : YEHCRM (yehs1225.com)"><meta data-react-helmet="true" property="og:description" content="Link : YEHCRM (yehs1225.com)"><link data-react-helmet="true" rel="icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/docs/Django/Build a CRM with Django"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Django/Build a CRM with Django" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/docs/Django/Build a CRM with Django" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f2b17ad4.css">
<link rel="preload" href="/assets/js/runtime~main.507c9dbe.js" as="script">
<link rel="preload" href="/assets/js/main.8f8dcb0d.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/favicon.png" alt="My Site Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Notes</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/yehs1225" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">🌜</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">🌞</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">Notes Intro</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/BasicKnowlege/CSS-RWD切版練習">BasicKnowlege</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/DataStructures/Graph">DataStructures</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/docs/Django/Build a CRM with Django">Django</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Django/Build a CRM with Django">Build a CRM with Django</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Django/Django_GetStarted">Django_GetStarted</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/JavaScript/JavaScript-this">JavaScript</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Reactjs/React_ES6">Reactjs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/docs/Tools/Command-Line-and-Vim">Tools</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Build a CRM with Django</h1><p>Link : <a href="https://django-crm.yehs1225.com/" target="_blank" rel="noopener noreferrer">YEHCRM (yehs1225.com)</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="專案開始前">專案開始前<a class="hash-link" href="#專案開始前" title="Direct link to heading">​</a></h4><ol><li><p>設定環境，在此使用的是miniconda</p></li><li><p>安裝django(3.1.4)</p><p><code>$pip freeze &gt; requirements.txt</code> 可以幫我們輸出文字檔以查看目前的套件dependencies</p></li><li><p>開始專案&lt; djcrm &gt;</p><p><code>$django-admin startproject djcrm .</code></p><p>djcrm後有一空格，會新增一資料夾在目前工作的位置下。</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="建立app">建立App<a class="hash-link" href="#建立app" title="Direct link to heading">​</a></h2><ul><li>建立一個叫做leads的app（會是一資料夾）</li></ul><p>​		<code>$python manage.py startapp leads</code></p><ul><li><p>在project中註冊app</p><p>在project的settings.py中，要在註冊的app中加入leads</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#djcrm/settings.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTALLED_APPS=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;leads&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="建立資料庫">建立資料庫<a class="hash-link" href="#建立資料庫" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="建立table">建立table<a class="hash-link" href="#建立table" title="Direct link to heading">​</a></h3><ul><li><p>在model.py中建立table</p><p><a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/" target="_blank" rel="noopener noreferrer">Model field reference</a></p><p>基本語法如下</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.db import models</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#使用models內的class Model來建立table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class &lt;&#x27;table_name&#x27;&gt;(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;field_name&#x27; = models.&#x27;field_type&#x27;(&#x27;condition&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#field_type : CharField、IntergerField、BooleanField...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#condition : max_length=X、default=X...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>CharField</strong>也可以設定choices讓人選擇</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class table(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   SOURCE_CHOICES = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (&#x27;YT&#x27;,&#x27;YouTube&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       (&#x27;Google&#x27;,&#x27;Google&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (&#x27;NewsLetter&#x27;,&#x27;NewsLetter&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#第一個值是要存入db的字串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#第二個是要顯示在畫面上的字串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    source = models.CharField(choices=SOURCE_CHOICES,max_length=100)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><strong>ImageField</strong></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">profile_picture = models.ImageField(blank=True,null=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#blank 代表使用者可輸入空白</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#null代表db可接受null值</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>執行makemigrations</p><p><code>$python manage.py makemigrations</code></p><p>migration的資料夾內會多出一個檔案000X_initial.py，裡面是這次新增加的table</p></li><li><p>執行migrate</p><p><code>$python manage.py migrate</code></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="連結兩table">連結兩table<a class="hash-link" href="#連結兩table" title="Direct link to heading">​</a></h3><ul><li><p>用 <code>ForeignKey()</code> 來連接</p><p>在要當作foriegn key的欄位加上<code>ForeignKey()</code>，<code>ForeignKey()</code>有兩個args，一是要連結的table；二是<code>on_delete</code>，代表要如何處置這筆資料當連結到的表格內容不存在時（像是被刪除之類的），有幾種選項設定：</p><ol><li><code>models.CASCADE</code>: 找不到foreignkey的指向就刪除</li><li><code>models.SET_NULL</code>:設定為null，僅在我們允許欄位為null時作用（<code>null=True</code>）</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class table1(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class table2(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fieldX = models.ForeignKey(&quot;table1&quot;,on_delete=models.XXX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="使用者table">使用者table<a class="hash-link" href="#使用者table" title="Direct link to heading">​</a></h3><p><strong>建議建立自己的user table</strong>，儘管也可用 <code>from django.contrib.quth import get_user_model</code>引入User</p><ul><li><p>引入django提供的模組</p><p><code>from django.contrib.auth.models import AbstractUser</code>，可按右鍵go to definition查看。</p></li><li><p>因為裡面已有使用者名稱、信箱等資訊，因此用pass保留原本的設定就好。如果希望加上其他欄位就直接加上就行了。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class User(AbstractUser):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pass</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在其他table設定user欄位</p><p>希望是1對1 : <code>OneToOneField</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class table(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user = models.OneToOneField(User,on_delete=models.CASCADE)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在project中的settings.py告知新增了user table</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#djcrm/setting.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AUTH_USER_MODEL = &#x27;leads.User&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="操作資料庫">操作資料庫<a class="hash-link" href="#操作資料庫" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="model-manager">Model Manager<a class="hash-link" href="#model-manager" title="Direct link to heading">​</a></h4><p>使用model manager : 取得model用<code>model_name.objects</code></p><ul><li><p>新增資料create</p><p><code>model_name.objects.create(field1=XX,...)</code></p></li><li><p>查詢query</p><ul><li><p>query all</p><p><code>model_name.objects.all()</code></p></li><li><p>query with filter</p><p><code>model_name.filter(field1=&quot;XXX&quot;)</code></p></li><li><p><strong>如果已經query all，再根據條件式用filter，那麼第二個filter其實不會真的去用到資料庫，因此不用擔心效能會變差</strong></p></li></ul></li></ul><ul><li><p>get 拿回一筆資料</p><p>get 和 query不同，只會有一筆資料，而且不是查詢是直接取回，但方法和filter類似</p><p><code>model_name.get(field1=&quot;XXX&quot;)</code></p><ul><li><p>當要取的資料是參照另一table時，在欄位後加上<code>__</code>+<code>欄位名稱</code>，例如一table &lt; Agent &gt;的user欄位是參照table User，而我們要取出特定email(此欄位屬於table User)。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">get_agent = Agent.objects.get(user__email=&quot;XXX&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li><li><p>可以用python shell來操作指令<code>$python manage.py shell</code></p><ul><li><p>新增user來測試<code>$python manage.py createsuperuser</code></p></li><li><p>接者開啟shell輸入，可看到以新增使用者</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth import get_user_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User = get_user_model()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User.objects.all()#&lt;QuerySet [&lt;User:yehs1225&gt;]&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="管理者頁面設定">管理者頁面設定<a class="hash-link" href="#管理者頁面設定" title="Direct link to heading">​</a></h2><p>django有自己提供好用的管理者頁面，一旦建立完model就可以在網頁上操作資料庫。介面上也可做調整，以方便操作。</p><p>在app中的admin.py中設定</p><ul><li><p>新增可被管理者操作的models</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/admin.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#引入想要加入的model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .models import User, Lead, Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#加到admin的page中</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.site.register(User)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.site.register(Lead)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.site.register(Agent)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="view">View<a class="hash-link" href="#view" title="Direct link to heading">​</a></h2><p>在view中引用資料庫（models），定義函數分別代表要從資料庫中執行的動作，例如app_list 、 app_detail等等。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="基本使用">基本使用<a class="hash-link" href="#基本使用" title="Direct link to heading">​</a></h4><ul><li><p>新增home page</p><ul><li><p>在app的view.py中新增一函數</p><ul><li><p>用HttpResponse回應</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.http import HttpResponse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def home_page(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return HttpResponse(&quot;hello world&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>用.html渲染（<strong>templates</strong>）</p><ul><li><p>我們需要在app裡新增資料夾<code>template</code>，再裡面再新增一資料夾（命名要和app名稱一樣），將.html檔案放在裡面。</p></li><li><p>在view.py則用以下方法</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def home_page(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/home_page.html&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在render中可加入第三個參數把想要加入頁面的內容傳送到html中</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def home_page(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;:&quot;cama&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;age&quot;:3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/home_page.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>而在html中則以<code>{{ NameOfKey }}</code>使用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{name}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{age}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>如果有多筆資料傳入時可用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% for item in list %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{item}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在project的setting.py中設定template</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#project/setting.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEMPLATES = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;DIRS&#x27;: [BASE_DIR/&quot;templates&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul></li><li><p>在project的urls.py中引入並加入要連結的地址</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#project/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from leads.views import home_page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,home_page)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="url-namespaces">URL Namespaces<a class="hash-link" href="#url-namespaces" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="讓url在它該在的app中">讓url在它該在的app中<a class="hash-link" href="#讓url在它該在的app中" title="Direct link to heading">​</a></h4><p>我們在project中的urls.py要告訴這個專案，有用到哪個app就去那個app中找。</p><ol><li><p>在app中新增urls.py這個檔案</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.urls import path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .views import home_page</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app_name = &#x27;leads&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;all/&#x27;,home_page)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>告訴project要去app中找連結</p><p><code>import include</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#project/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib import admin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.urls import path,include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;app_name/&#x27;,include(&#x27;app_name.urls&#x27;,namespace=&quot;app_name&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="要看整個list和它的detail">要看整個list和它的detail<a class="hash-link" href="#要看整個list和它的detail" title="Direct link to heading">​</a></h4><p>假設我們現在有個網頁僅列出列表（list），每列呈現使用者姓名，並且希望能夠透過特定的primary key number作用於urls以連結到指定使用者的詳細訊息（detail）。下圖的id就是此table的primary key，例如我們希望輸入1時就帶往Joe的頁面。</p><ol><li><p>首先我們在view.py中新增一函數，接收<code>request</code>及<code>pk</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def lead_detail(reauest,pk):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(pk)#顯示在terminal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return HttpResponse(&quot;here is the detail view&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>接者在urls.py中以<code>&lt;int:pk&gt;/</code>讓路徑在接收到pk時會使用detail這個函數</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,lead_list),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/&#x27;,lead_detail)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>希望在原本html頁面中新增&lt; a &gt;tag，如此一來當我們點擊某個使用者後，就會將頁面帶向該使用者的詳細內容。</p><p>可以直接在<code>href</code>用<code>key.pk</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% for lead in leads %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;div class=&quot;lead&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;a href=&quot;/leads/{{lead.pk}}/&quot;&gt;{{lead.first_name}} {{lead.last_name}}&lt;/a&gt;. Age: {{lead.age}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>確認可運作後就可以新建一個html頁面for detail，並將httpResponse改為render</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def lead_detail(request,pk):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lead = Lead.objects.get(id=pk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;lead&#x27;:lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/lead_detail.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="forms">Forms<a class="hash-link" href="#forms" title="Direct link to heading">​</a></h2><p>希望能夠提交表單來新增使用者等，新增使用者在admin中可以辦到，但在此希望可以利用網頁提交表單的方式。</p><ol><li><p>新增create.html在templates/app內</p></li><li><p>新增路徑在app/urls.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,lead_list),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;create/&#x27;,lead_detail),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/&#x27;,lead_create)#等會要在view.py中新增一函數create</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在app底下新建forms.py</p><p>可以把app中所有要用到表單定義在這裡，再在view.py中引入</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/forms.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django import forms#引用forms模組</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LeadForm(forms.Form):#使用forms中的Form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first_name=forms.CharField()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last_name = forms.CharField()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age=forms.IntegerField(min_value=0)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在view.py中使用forms</p><p>主要的步驟如下</p><ol><li>從forms.py引用需要的form</li><li>在context中先填入form <code>form = LeadForm()</code></li><li>檢查是否為POST <code>if request == &quot;POST&quot;</code>，是則填入request<code>form = LeadForm(request.POST)</code></li><li><code>form.is_valid()</code>django檢查是否有效</li><li>用<code>form.cleaned_data</code>拿到&quot;乾淨&quot;的資料並取出</li><li>有特定欄位無法從取得，可考慮拿出該table中的第一筆資料來用<code>table.objects.first()</code></li><li>建立資料<code>table.objects.create(...)</code></li><li><code>redirect</code>導回頁面，（須<code>from django.shortcuts import redirect</code>）</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/veiws.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.shortcuts import redirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .models  import Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .forms import LeadForm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def lead_create(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form = LeadForm()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if request.method==&quot;POST&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(&#x27;Receiving a post request&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        form = LeadForm(request.POST) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if form.is_valid():#check form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(&quot;the form is valid&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(form.cleaned_data)#got{&#x27;first_name&#x27;: &#x27;Sally&#x27;, &#x27;last_name&#x27;: &#x27;Somul&#x27;, &#x27;age&#x27;: 28}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            first_name = form.cleaned_data[&#x27;first_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            last_name = form.cleaned_data[&#x27;last_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            age = form.cleaned_data[&#x27;age&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            #because we don&#x27;t get agent from form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            agent = Agent.objects.first()#got first row of Agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Lead.objects.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                first_name = first_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                last_name = last_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                age = age,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                agent = agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            print(&quot;lead created&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return redirect(&#x27;/leads&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context={</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;form&quot;:form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/lead_create.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在html檔中設定</p><ul><li><p>在引用要用form tag包起來，才可以提交</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//app/templates/app/create.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;post&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% csrf_token %}{% comment %} 防止csrf {% endcomment %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{form.as_p}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;button&gt;submit&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>引用傳入參數時，可以設定呈現樣式，例如下面右邊以&lt; p &gt; paragh呈現。</p></li></ul></li></ol><table><thead><tr><th>{{form}}</th><th>{{form.as_p}}</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="model-form">Model Form<a class="hash-link" href="#model-form" title="Direct link to heading">​</a></h2><p>除了上面自己做一個form之外，可以用django提供的ModelForm直接把model變成form。</p><ol><li><p>在forms.py設定model form</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/forms.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .models import Lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Table1ModelForm(forms.ModelForm):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model = Lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fields = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field1,#field in the table</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在view.py中更改函數內容</p><p>將之前用到<code>Table1Form</code>改成<code>Table1ModelForm</code>，這時表單就會收到原本table所需要的所有欄位，所以之前取用table2中的第一筆資料的做法也可改回使用使用者輸入的資料就行。</p><p>此外，因為我們已經在forms.py中建立ModelForm指定要使用哪個model，所以也可以把確認<code>form.is_valid():</code>之後</p><p>要取出資料再放入table中的動作</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">first_name = form.cleaned_data[&#x27;first_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">last_name = form.cleaned_data[&#x27;last_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">age = form.cleaned_data[&#x27;age&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">agent = form.cleaned_data[&#x27;agent&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Lead.objects.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first_name = first_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last_name = last_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age = age,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>簡化為</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">form.save()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><p>​		內可傳參數，例如<code>commit=False</code>代表不要馬上傳到model，我們可用object儲存目前form得到的狀態，在進行額外操作，所以可變成<code>obj=form.save(commit=False)</code></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="update-view-form">Update View （Form）<a class="hash-link" href="#update-view-form" title="Direct link to heading">​</a></h2><ol><li><p>定義新函數在app/view.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def lead_update(request,pk):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lead =Lead.objects.get(id=pk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form = LeadForm()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if request.method==&quot;POST&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        form = LeadForm(request.POST) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if form.is_valid():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            first_name = form.cleaned_data[&#x27;first_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            last_name = form.cleaned_data[&#x27;last_name&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            age = form.cleaned_data[&#x27;age&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lead.first_name = first_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lead.last_name = last_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lead.age = age</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lead.save()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return redirect(&#x27;/leads&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;form&quot;:form,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;lead&#x27;:lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;app/lead_update.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>跟create一樣，也可改用較簡潔的方式</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/view.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def lead_update(request,pk):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lead = Lead.objects.get(id=pk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form = LeadModelForm(instance=lead)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if request.method==&quot;POST&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        form = LeadModelForm(request.POST,instance=lead) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if form.is_valid():</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            form.save()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return redirect(&#x27;/leads&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;form&quot;:form,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;lead&#x27;:lead</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/lead_update.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>新增app/templates/update.html</p><p>基本上跟create一樣</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//app/templates/update.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;post&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {{form.as_p}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;button&gt;submit&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在app/urls.py中要新增path</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path(&#x27;&lt;int:pk&gt;/update/&#x27;,lead_update),</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="delete-viewform">Delete View（form）<a class="hash-link" href="#delete-viewform" title="Direct link to heading">​</a></h2><ol><li><p>定義新函數在app/view.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def lead_delete(request,pk):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lead=Lead.objects.get(id=pk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lead.delete()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return redirect(&#x27;/leads&#x27;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在app/urls.py加上path</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/delete/&#x27;,lead_delete),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在detail.html加上刪除的link</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;/leads/{{ lead.pk }}/delete&quot;&gt;Delete&lt;/a&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="url-names">URL Names<a class="hash-link" href="#url-names" title="Direct link to heading">​</a></h2><p>現在的app/urls.py中的path長這樣</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,lead_list),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/&#x27;,lead_detail),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/update/&#x27;,lead_update),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/delete/&#x27;,lead_delete),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;create/&#x27;,lead_create),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>也就是說，我們在網址列輸入對應的字串就能進到該路徑位置，然而，有時候我們會希望可以更改顯示在網址列的字，於是將path中的第一個參數例如<code>create</code>直接改成<code>create-a-lead</code>，這樣確實是改好了沒錯，但是但是!如果在其他.html的&lt; a &gt; tag中的<code>href</code>有指向<code>/create</code>的話就必須要都更改，要在茫茫人海中尋找實在不容易。這也是為何我們應該要避免<strong>hardcode</strong>出現的原因。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="path的第三個參數---name">path的第三個參數 - name<a class="hash-link" href="#path的第三個參數---name" title="Direct link to heading">​</a></h4><p>要避免hardcode出現，就是加上第三個參數，並且在其他需要連結到的地方都是用name所設定好的字串，如此一來以後要改顯示在網址列的字串時就不用擔心!</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/urls.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,lead_list,name=&#x27;lead-list&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/&#x27;,lead_detail,name=&#x27;lead-detail&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/update/&#x27;,lead_update,name=&#x27;lead-update&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&lt;int:pk&gt;/delete/&#x27;,lead_delete,name=&#x27;lead-delete&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;create/&#x27;,lead_create,name=&#x27;lead-create&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>而在各html檔案中，則可將<code>href</code>改為<code>{% url &#x27;leads:XXXX&#x27; %}</code>的形式，第一個<code>leads</code>是因為我們在project中的urls.py有這一行<code>path(&#x27;leads/&#x27;,include(&#x27;leads.urls&#x27;,namespace=&quot;leads&quot;))</code>，而<code>:</code>之後接的<code>XXX</code>就是我們在<code>name</code>所設定的。</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="一般的html中link的變動">一般的html中link的變動<a class="hash-link" href="#一般的html中link的變動" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//原始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;/leads/create&quot;&gt;Create a new Lead&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//變成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;{% url &#x27;leads:lead-create&#x27; %}&quot;&gt;Create a new Lead&lt;/a&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h5 class="anchor anchorWithStickyNavbar_mojV" id="有包含pk的">有包含pk的<a class="hash-link" href="#有包含pk的" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//原始</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;/leads/{{lead.pk}}/&quot;&gt;{{lead.first_name}} {{lead.last_name}}&lt;/a&gt;. Age: {{lead.age}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//變成</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;{% url &#x27;leads:lead-detail&#x27; lead.pk %}&quot;&gt;{{lead.first_name}} {{lead.last_name}}&lt;/a&gt;. Age: {{lead.age}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="extending-templates">Extending Templates<a class="hash-link" href="#extending-templates" title="Direct link to heading">​</a></h2><p>因為我們創造的create、detail、update....等等所有的html都很相似，因此應該做些優化，避免重複做同樣的事情。</p><ol><li><p>在最外層（at the same layer of project and apps）新增templates資料夾，並新增base.html（取叫base是慣例）</p><ul><li>放入相同的東西例如整個html大綱、title、sytle等等</li><li>在<code>body</code>部分，則是用<code>{% block content %}</code>、<code>{% endblock content %}</code>包住，代表到時候要被渲染的東西會放在這個<code>block</code>中</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html lang=&quot;en&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;style&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .lead{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            padding:10px 6px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            margin-top:10px;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            background-color:#f6f6f6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            width:100%;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/style&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;title&gt;YEHCRM&lt;/title&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% endblock content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><ol start="2"><li><p>把原先html中很相似的地方刪除</p><p>以lead_list來說就是除了這段以外的。</p><ul><li>在開頭加上<code>{% extends &quot;base.html&quot; %}</code></li><li>並用<code>{% block content %}</code>、<code>{% endblock content %}</code>包住要被渲染的（就是下面這區塊）</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &quot;base.html&quot; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;a href=&quot;{% url &#x27;leads:lead-create&#x27; %}&quot;&gt;Create a new Lead&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;hr/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;This is all or our list&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% for lead in leads %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;div class=&quot;lead&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;a href=&quot;{% url &#x27;leads:lead-detail&#x27; lead.pk %}&quot;&gt;{{lead.first_name}} {{lead.last_name}}&lt;/a&gt;. Age: {{lead.age}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% endfor %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="如果想要引用其他檔案">如果想要引用其他檔案<a class="hash-link" href="#如果想要引用其他檔案" title="Direct link to heading">​</a></h5><p>例如在和base.html同層新增一個scripts.html，在base中用<code>{% include%}</code>引用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% include &quot;script.html&quot; %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="twailwindcss">TwailwindCss<a class="hash-link" href="#twailwindcss" title="Direct link to heading">​</a></h2><p>Found useful component here ! <a href="https://github.com/aniftyco/awesome-tailwindcss" target="_blank" rel="noopener noreferrer">https://github.com/aniftyco/awesome-tailwindcss</a></p><p>下面這裡是用<a href="https://tailblocks.cc/" target="_blank" rel="noopener noreferrer">https://tailblocks.cc/</a></p><ol><li><p>在base.html引用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;script src=&quot;https://cdn.tailwindcss.com&quot;&gt;&lt;/script&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>建立navbar</p><ol><li>在twailwind中找到適用的模板後，在與base.html同層的地方新建navbar.html，並將code貼入</li><li>在base.html引入（<code>{% include &quot;navbar.html&quot; %}</code>）</li></ol></li><li><p>建立登入頁面</p><ol><li><p>建立landing.html</p></li><li><p>在app/views.py中定義新函數</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def leading_page(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;landing.html&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在project中的urls.py新增路徑</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from leads.views import landing_page#引入剛定義好的函數</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;&#x27;,landing_page,name=&#x27;landing-page&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol></li><li><p>為已存在的html加上twailwind css</p><p>直接加在<code>{% block content %}</code>內</p></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="class-based-view">Class Based View<a class="hash-link" href="#class-based-view" title="Direct link to heading">​</a></h2><p>之前都是用function based view，來handle request，而用class可以減少很多code，Django就提供了<code>django.views.generic</code>這個模組，裡面可以引用各種view來使用，之後再到urls.py作相對應的修正。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="crud">CRUD<a class="hash-link" href="#crud" title="Direct link to heading">​</a></h4><p>Create, Retrieve, Update and Delete + List.</p><p>基本上所有的網頁都可由這些動作完成，因此Django很貼心的提供了這些View讓我們使用，每個view中最基礎的設定就是<code>template_name</code>。以下對各種情況分別進行修改：</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="一般頁面---templateview">一般頁面 - <code>TemplateView</code><a class="hash-link" href="#一般頁面---templateview" title="Direct link to heading">​</a></h4><p>e.g.Landing_page</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改viewspy的func--class-based">修改views.py的func =&gt; class based<a class="hash-link" href="#修改viewspy的func--class-based" title="Direct link to heading">​</a></h5><p>原先的function</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def landing_page(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;landing.html&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>引用TemplateView</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.views.generic import TemplateView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LandingPageView(TemplateView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name=&quot;landing.html&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改在projecturlspy中引用的模組及路徑">修改在project/urls.py中引用的模組及路徑<a class="hash-link" href="#修改在projecturlspy中引用的模組及路徑" title="Direct link to heading">​</a></h5><p>引入ClassBasedView後，以<code>ClassBasedView.as_view()</code>的方式呼叫</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from leads.views import landing_page,LandingPageView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.. path(&#x27;&#x27;,LandingPageView.as_view(),name=&#x27;landing-page&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="list頁面---listview">List頁面 - <code>ListView</code><a class="hash-link" href="#list頁面---listview" title="Direct link to heading">​</a></h4><p>e.g.lead_list</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>queryset</code>:放入要操作資料庫的部分。</p><p><code>context_object_name</code>optional but recommend（說明在第三點html）</p><ol><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改viewspy的func--class-based-1">修改views.py的func =&gt; class based<a class="hash-link" href="#修改viewspy的func--class-based-1" title="Direct link to heading">​</a></h5><p>原先的function</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def lead_list(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leads = Lead.objects.all()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;leads&#x27;:leads,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/lead_list.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>引用ListView</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class LeadVistView(ListView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;leads/lead_list.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryset = Lead.objects.all()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改在appurls中引用的模組及路徑">修改在app/urls中引用的模組及路徑<a class="hash-link" href="#修改在appurls中引用的模組及路徑" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from .views import (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LeadVistView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..   path(&#x27;&#x27;,LeadVistView.as_view(),name=&#x27;lead-list&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修正html中的參數">修正html中的參數<a class="hash-link" href="#修正html中的參數" title="Direct link to heading">​</a></h5><ul><li>因為原先的function是自訂context內容再傳去html中，像這樣：</li></ul></li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">def lead_list(request):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;leads&#x27;:leads,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return render(request,&quot;leads/lead_list.html&quot;,context)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>   因此，我們在html中是以<code>leads</code>來取用內容，而使用ListView時，預設的名稱是<code>object_list</code>，所以把這部分改掉就行：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% for lead in leads %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% for lead in object_list %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li>​	或者設定<code>context_object_name</code>，就不用更改html檔案</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class XXX(ListView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context_object_name = &quot;leads&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="detail頁面---detailview">Detail頁面 - <code>DetailView</code><a class="hash-link" href="#detail頁面---detailview" title="Direct link to heading">​</a></h4><p>e.g.lead_detail</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queryset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>大致上與List相同，僅注意在<code>queryset</code>也是使用一樣的<code>Lead.objects.all()</code>而不需要像原本function中設定用<code>.get(id=pk)</code></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="create頁面---createview">Create頁面 - <code>CreateView</code><a class="hash-link" href="#create頁面---createview" title="Direct link to heading">​</a></h4><p>e.g.lead_create</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>form_class</code>:連結表單的部分。</p><p><code>reverse</code>:重新導回某頁面。</p><ol><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改viewspy的func--class-based-2">修改views.py的func =&gt; class based<a class="hash-link" href="#修改viewspy的func--class-based-2" title="Direct link to heading">​</a></h5><ul><li><p>form_class</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Class XXX(CreateView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form_class = LeadModelForm</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>import reverse from django.shortcuts</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.shortcuts import reverse</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><code>reverse()</code>內是<code>namespace</code>(leads) + <code>path (name)</code>(lead-list)</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">    def get_success_url(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return reverse(&quot;leads:lead-list&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="修改urlspy的path">修改urls.py的path<a class="hash-link" href="#修改urlspy的path" title="Direct link to heading">​</a></h5></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="update頁面---updateview">Update頁面 - <code>UpdateView</code><a class="hash-link" href="#update頁面---updateview" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">form_class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queryset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>需要操作表單和資料庫，所以用到</p><p><code>form_class</code>及<code>queryset</code>，</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class LeadUpdateView(UpdateView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;leads/lead_update.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryset = Lead.objects.all()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form_class = LeadModelForm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_success_url(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return reverse(&quot;leads:lead-list&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="delete頁面---deleteview">Delete頁面 - <code>DeleteView</code><a class="hash-link" href="#delete頁面---deleteview" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">template_name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">queryset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="viewspy的class">views.py的class<a class="hash-link" href="#viewspy的class" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class LeadDeleteView(DeleteView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;leads/lead_delete.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    queryset = Lead.objects.all()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_success_url(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return reverse(&quot;leads:lead-list&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><h5 class="anchor anchorWithStickyNavbar_mojV" id="templatesapphtml">templates/app/.html<a class="hash-link" href="#templatesapphtml" title="Direct link to heading">​</a></h5><p>因為必須要有<code>template_name</code>，所以我們要新建一個lead_delete.html。	</p><p>這裡我們同樣保留form tag，因為在DeleteView就是預設要有提交的功能來確定要刪除。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% comment %} app/templates/app/.html {% endcomment %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &quot;base.html&quot; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;a href=&quot;{% url &#x27;leads:lead-list&#x27; %}&quot;&gt;Go back to leads&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;hr/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;Are you sure you want to delete this lead&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;form method=&quot;post&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {{form.as_p}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;button&gt;submit&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="set-static-files">Set Static files<a class="hash-link" href="#set-static-files" title="Direct link to heading">​</a></h2><ol><li><p>在最外層創建資料夾static並創建資料夾&lt; js &gt;、&lt; css &gt;、&lt; images &gt;來存放以後要用的檔案</p></li><li><p>在project中的settings.py可以看到本來就有<code>STATIC_URL = &#x27;/static/&#x27;</code>，我們另外再設定下面兩個變數</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">STATICFILES_DIRS=[</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BASE_DIR/&quot;static&quot; #像在template的設定</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">STATIC_ROOT=&quot;static_root&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在project/urls.py設定</p><ul><li><p><code>from django.conf import settings</code>讓我們可以使用第二點setting中的<code>STATIC_URL</code>和<code>STATIC_ROOT</code></p></li><li><p><code>from django.conf.urls.static import static</code>讓我們可以設定</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">static(&#x27;settins.STATIC_URL&#x27;,document_root=settings.STATIC_ROOT)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>我們將這一段加在底下，而不是直接放在URLPattern中，因為當部署時，server可能會將STATIC移至不同位置，不像現在在本地開發的狀態，所以不總是執行他。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">if settings.DEBUG:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    urlpatterns += static(&#x27;settins.STATIC_URL&#x27;,document_root=settings.STATIC_ROOT)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li><li><p>在base.html中使用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% load static %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;!DOCTYPE html&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;html lang=&quot;en&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;link href=&quot;{% static &#x27;css/styles.css&#x27; %}&quot; rel=&quot;stylesheet&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/head&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;script src=&quot;{% static &#x27;js/main.js&#x27; %}&quot;/&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/body&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/html&gt; </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="send-emails">Send Emails<a class="hash-link" href="#send-emails" title="Direct link to heading">​</a></h2><p>現在我們想要在「新增玩Lead時，寄發email」。因此我們在app/views.py定義class  LeadCreateView定義新函數。</p><p>註：我們可以選取引用的模組按右鍵:go to defination 去查看原始的定義。</p><ol><li><p>重新定義<code>form_valid</code>之後要執行的事</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LeadCreateView(CreateView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def form_valid(self,form):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super(LeadCreateView,self).form_valid(form)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>引入<code>send_email</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#app/views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.core.mail import send_mail</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def form_valid(self,form):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #TO SEND EMAIL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        send_mail(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            subject=&quot;A lead has been created&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            message=&quot;Go to the site to see the new lead&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            from_email=&quot;test@test.com&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            recipient_list=[&quot;test2@test.com&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super(LeadCreateView,self).form_valid(form)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>在project中settings.py設定</p><p>告訴django如何 send email</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#project/settings.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EMAIL_BACKEND = &quot;django.core.mail.backends.console.EmailBackend&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#in real , we use smtp instead of console</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><p>最後就可得到</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Content-Type: text/plain; charset=&quot;utf-8&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MIME-Version: 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Content-Transfer-Encoding: 7bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Subject: A lead has been created</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">From: test@test.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">To: test2@test.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Date: Fri, 25 Feb 2022 06:24:40 -0000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Message-ID: &lt;164577028083.2132.15977409263506702204@yehs1225-VirtualBox&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Go to the site to see the new lead</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="authentication">Authentication<a class="hash-link" href="#authentication" title="Direct link to heading">​</a></h2><p>*使用miniconda來建立環境。</p><p>可以在minconda3/python3.9/site-packages/django/contrib/auth/auth/views.py中查看定義好的相關模組，裡面有Login、Logout、Password相關view。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="loginlogout">Login/Logout<a class="hash-link" href="#loginlogout" title="Direct link to heading">​</a></h4><p>其中我們要使用的是<code>class LoginView()</code>、<code>class LogoutView()</code>，在<code>template_name</code>中會用到&#x27;registration/login.html&#x27;，所以我們回到最外層的templates中新建資料夾和檔案。</p><ol><li><p>templates/registration/login.html</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#templates/registration/login.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &#x27;base.html&#x27; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;POST&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ form.as_p }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;button type=&quot;submit&quot;&gt;Login&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>project/urls.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.views import LoginView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...    path(&#x27;&#x27;,LoginView.as_view(),name=&#x27;login&#x27;),   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>project/settings.py</p><p>因為預設完登入後會導回特定的url，但我們沒有要新增一個檔案，只是希望回到本來app的首頁，所以可在settings中設定</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">LOGIN_REDIRECT_URL=&quot;/leads&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>設定navbar的登入狀態顯示</p><ul><li><code>{% if request.user.is_authenticated %}</code>、<code>{% else %}</code>和<code>{% endif %}</code></li><li>&lt; a &gt; Login的href也要記得更改</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% if not request.user.is_authenticated %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;a class=&quot;mr-5 hover:text-gray-900&quot;&gt;Sign up&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endif %}    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% if request.user.is_authenticated %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   You are logged in: {{request.user.username}}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% else %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;a href=&quot;{% url &#x27;login&#x27; %}&quot; class=&quot;inline-flex items-center bg-gray-100 border-0 py-1 px-3 focus:outline-none hover:bg-gray-200 rounded text-base mt-4 md:mt-0&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Login</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;svg fill=&quot;none&quot; stroke=&quot;currentColor&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot; stroke-width=&quot;2&quot; class=&quot;w-4 h-4 ml-1&quot; viewBox=&quot;0 0 24 24&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;path d=&quot;M5 12h14M12 5l7 7-7 7&quot;&gt;&lt;/path&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/svg&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endif %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h4 class="anchor anchorWithStickyNavbar_mojV" id="sign-up">Sign up<a class="hash-link" href="#sign-up" title="Direct link to heading">​</a></h4><ol><li><p>app/forms.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth import get_user_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.forms import UserCreationForm,UsernameField</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CustomUserCreationForm(UserCreationForm):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    class Meta:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        model = User</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fields =(&quot;username&quot;,)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        field_classes = {&#x27;username&#x27;:UsernameField}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>class Meta</code>讓你可在model內用metadata（指的是任何非model中現存的欄位）</p></li><li><p>app/views.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from .forms import ...,CustomUserCreationForm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class SignupView(CreateView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;registration/signup.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form_class = UserCreationForm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_success_url(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return reverse(&quot;login&quot;)   </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>template/registration/signup.html</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &#x27;base.html&#x27; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;POST&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ form.as_p }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;button type=&quot;submit&quot;&gt;SignUp&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>app/urls.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... path(&#x27;signup/&#x27;,SignupView.as_view(),name=&#x27;signup&#x27;),  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="test">Test<a class="hash-link" href="#test" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="1-just-in-apptestpy">1. Just In app/test.py<a class="hash-link" href="#1-just-in-apptestpy" title="Direct link to heading">​</a></h4><p>我們可以在app資料夾中找到test.py並在其中撰寫Class 和 function ，以<code>$python manage.py test</code>來測試。</p><ul><li>class LandingPageTest 測試views.py中的Landing page</li><li>function以<code>test_</code>作為開頭，被視為一個test</li><li><code>(self)</code>提供許多function可用來測試</li><li><code>self.client</code>就像<code>request</code>一樣可以用<code>.get</code>、<code>.post</code>等等http 請求方法</li><li><code>reverse</code>用來連到url</li><li><code>self.assertEqual</code>檢查兩物件是否相等</li><li><code>self.assertTemplateUsed</code>檢查response是否是想要的檔案</li></ul><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.test import TestCase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.shortcuts import reverse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LandingPageTest(TestCase):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def test_get(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response = self.client.get(reverse(&quot;landing-page&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # TO test status code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.assertEqual(response.status_code,200)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # TO test template code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.assertTemplateUsed(response,&quot;landing.html&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="2-make-a-folder--test">2. Make a folder : test<a class="hash-link" href="#2-make-a-folder--test" title="Direct link to heading">​</a></h4><p>因為之後專案可能會變很大，所以一個好的做法可以在app底下新增資料夾tests，裡面先新增一個<code>__init__.py</code>，在像上面一樣建立想要的<code>test.py</code>，命名方式可以是<code>test_views.py</code>、<code>test_forms.py</code>等。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="auth-permissions">Auth Permissions<a class="hash-link" href="#auth-permissions" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="這不是誰都可以看的">這不是誰都可以看的💢<a class="hash-link" href="#這不是誰都可以看的" title="Direct link to heading">​</a></h4><p>有些views我們希望在有權限的人登錄後才可以看到。我們需要</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.mixins import LoginRequiredMixin</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>並且將<code>LoginRequiredMixin</code>放在class（）第一個位置像這樣</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class LeadVistView(LoginRequiredMixin,ListView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>接者在瀏覽器的網址列可看到</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">http://localhost:8000/accounts/login/?next=/leads/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>會先導到登入頁面，在redirect到原本要去的頁面，其中登入頁面預設為<code>accounts/login</code>，但我們的app中是設定<code>login</code>，所以去project中settings.py設定</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">LOGIN_URL = &#x27;/login&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="你的專屬內容">你的專屬內容<a class="hash-link" href="#你的專屬內容" title="Direct link to heading">​</a></h4><p>我們現在有3個models:User, Lead, Agent，希望做到的功能是使用者登入後，屬於該User的Lead和Agent可以呈現及管理，因此我們新增一個model叫做UserProfile，並且也修改Agent。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class UserProfile(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user = models.OneToOneField(&quot;User&quot;,on_delete=models.CASCADE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __str__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return self.user.username</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Agent(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user = models.OneToOneField(&quot;User&quot;,on_delete=models.CASCADE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organization = models.ForeignKey(UserProfile,on_delete=models.CASCADE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __str__(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return self.user.email    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>新增完新model要記得去admin.py註冊</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from .models import ...,UserProfile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">admin.site.register(UserProfile)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="signal">Signal<a class="hash-link" href="#signal" title="Direct link to heading">​</a></h4><p>可以做設定，讓發生特定事情時django會發送signal。</p><p>目前想做的是：當有新user被建立時，就新建一筆UserProfile資料。</p><ol><li>引入模組：</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.db.models.signals import post_save</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>post_save</code> :當POST請求被成功儲存在model時（另外也有<code>pre_save</code>，作用於尚未被存到資料庫時）</p><ol><li>定義function：</li></ol><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># a signal once the post_save is set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def post_user_created_signal(sender,instance, created, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if created:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        UserProfile.objects.create(user=instance)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">post_save.connect(post_user_created_signal,sender=User)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p><code>post_save.connect(arg1,arg2)</code>：</p><ul><li>arg1 : 要呼叫的function</li><li>arg2 : 要連接的model</li></ul><p><code>def post_user_created_signal(sender,instance, created, **kwargs)</code> :</p><ul><li>sender : signal連接的model</li><li>instance : 發出訊號的物件，例如這裡是更改使用者test1的資料，print出來就是test1</li><li>created : 用來偵測這次的signal是否是全新的post或只是修改</li><li>**kwargs : 接收剩餘所有arguments</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="user-types">User Types<a class="hash-link" href="#user-types" title="Direct link to heading">​</a></h4><p>將user分為兩類：組織管理者（organizor）及單一機構（agent）。於是回到原先建立的model User增加新欄位<code>is_organizer</code>及<code>is_agent</code>。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class User(AbstractUser):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_organizor = models.BooleanField(default=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    is_agent = models.BooleanField(default=False)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>之後我們可以在navbar中過濾是否為organizor</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% if request.user.is_organizor %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;a href=&quot;{% url &#x27;agents:agent-list&#x27; %}&quot; class=&quot;mr-5 hover:text-gray-900&quot;&gt;Agents&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endif %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>然而這樣只是不顯示在渲染的畫面上，實際上仍可透過在網址上直接輸入來存取指定頁面，因此應該在views.py去做限制。</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="客製化的mixin">客製化的Mixin<a class="hash-link" href="#客製化的mixin" title="Direct link to heading">​</a></h4><p>在前面設定view時我們曾經用過</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.mixins import LoginRequiredMixin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class LeadVistView(LoginRequiredMixin,ListView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>來確認使用者是否已登入，但是現在不只是使用者登入，還要檢查他是否為organizer，因此我們去察看此模組後</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class LoginRequiredMixin(AccessMixin):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Verify that the current user is authenticated.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def dispatch(self, request, *args, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not request.user.is_authenticated:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return self.handle_no_permission()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super().dispatch(request, *args, **kwargs)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>可以用<code>AccessMixin</code>來客製化自己的mixin。</p><ol><li><p>新增mixins.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.mixins import AccessMixin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from django.shortcuts import redirect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class OrganizorAndLoginRequiredMixin(AccessMixin):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Verify that the current user is authenticated and is organizor.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def dispatch(self, request, *args, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not request.user.is_authenticated or not request.user.is_organizor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return redirect(&quot;leads:lead-list&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super().dispatch(request, *args, **kwargs)    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>除了在if判斷中加入</p><p><code>or not request.user.is_organizor</code></p><p>由於 return 原先的<code>self.handle_no_permission()</code>是會丟出error code（403 Forbidden），我們可以把它改成redirect到指定頁面。</p></li><li><p>在views.py中引用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#agents.views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from .mixins import OrganizorAndLoginRequiredMixin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class AgentListView(OrganizorAndLoginRequiredMixin,generic.ListView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;agents/agent_list.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context_object_name = &quot;agents&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_queryset(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return Agent.objects.all()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ol><h2 class="anchor anchorWithStickyNavbar_mojV" id="password">Password<a class="hash-link" href="#password" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="set-random-password">set random password<a class="hash-link" href="#set-random-password" title="Direct link to heading">​</a></h4><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">user.set_password(f&quot;{random.randint(0,100000)}&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="reset-password">reset password<a class="hash-link" href="#reset-password" title="Direct link to heading">​</a></h4><p>在auth.views中有提供重設密碼的view（如同login/logout），因此我們在project的urls.py中引用，1並在url中加入路徑。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">from django.contrib.auth.views import(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PasswordResetView,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PasswordResetDoneView,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PasswordResetConfirmView</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">urlpatterns = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;password-reset/&#x27;,PasswordResetView.as_view(),name=&#x27;password-reset&#x27;),   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;password-reset-confirm/&lt;uidb64&gt;/&lt;token&gt;&#x27;,PasswordResetConfirmView.as_view(),name=&#x27;password-reset-confirm&#x27;),   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path(&#x27;password-reset-done/&#x27;,PasswordResetDoneView.as_view(),name=&#x27;password-reset-confirm&#x27;),   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>在引用後去查看這幾個vieew可以看到他們分別會對應需要的.html檔案</p><ul><li><p>PasswordResetView</p><ul><li><p>password_reset_form.html</p><p>按forget password後會先連到這裡</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &#x27;base.html&#x27; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;POST&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ form.as_p }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;button type=&quot;submit&quot;&gt;Reset password&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;hr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;{% url &#x27;login&#x27;%}&quot;&gt;Already have an account?&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>password_reset_email.html</p><p>下方這個link的呈現方式不是最佳的，django有提供相關package可使用。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">You&#x27;ve requested to reset your password.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please click the following link to enter your new password :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{{ protocol }}://{{ domain }}/password-reset-confirm/{{uid}}/{{token}}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul><ul><li><p>PasswordResetConfirmView</p><ul><li><p>password_reset_confirm.html</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &#x27;base.html&#x27; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;form method=&quot;POST&quot;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {% csrf_token %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {{ form.as_p }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;button type=&quot;submit&quot;&gt;Reset password&lt;/button&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;hr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;a href=&quot;{% url &#x27;login&#x27;%}&quot;&gt;Already have an account?&lt;/a&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul><ul><li><p>PasswordResetDoneView</p><ul><li><p>password_reset_done.html</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &quot;base.html&quot; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;h1&gt;We&#x27;ve sent a email to reset the password&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li><li><p>PasswordResetCompleteView</p><ul><li><p>password_reset_complete.html</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% extends &#x27;base.html&#x27; %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% block content %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;h1&gt;Password reset completed&lt;/h1&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;hr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;p&gt;Click &lt;a href=&quot;{% url &#x27;login&#x27;%}&quot;&gt;here&lt;/a&gt; to login&lt;/p&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endblock content %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="dynamic-choices">Dynamic choices<a class="hash-link" href="#dynamic-choices" title="Direct link to heading">​</a></h2><h4 class="anchor anchorWithStickyNavbar_mojV" id="pass-arguments-from-views-to-forms">Pass arguments from views to forms<a class="hash-link" href="#pass-arguments-from-views-to-forms" title="Direct link to heading">​</a></h4><p>views.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#pass extra arguments into the form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def get_form_kwargs(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;request&quot;:self.request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>forms.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class AssinAgentForm(forms.Form):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = forms.ModelChoiceField(queryset=Agent.objects.none())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #get parameter passed in views</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, *args, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        print(kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#{&#x27;request&#x27;: &lt;WSGIRequest: GET &#x27;/leads/1/assign-agent/&#x27;&gt;}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="assign-agents-to-lead-agent-in-the-organization">Assign agents to lead (agent in the organization)<a class="hash-link" href="#assign-agents-to-lead-agent-in-the-organization" title="Direct link to heading">​</a></h4><p>the choices of agents are generated dynamically according to the organization.</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">#views.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class AssignAgentView(OrganizorAndLoginRequiredMixin,FormView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &quot;leads/assign_agent.html&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    form_class = AssinAgentForm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #pass extra arguments into the form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_form_kwargs(self,**kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kwargs=super(AssignAgentView,self).get_form_kwargs(**kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kwargs.update({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;request&quot;:self.request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return kwargs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_success_url(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return reverse(&quot;leads:lead-list&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def form_valid(self,form):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agent = form.cleaned_data[&#x27;agent&#x27;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lead = Lead.objects.get(id=self.kwargs[&quot;pk&quot;])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lead.agent = agent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lead.save()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return super(AssignAgentView,self).form_valid(form)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#forms.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class AssinAgentForm(forms.Form):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = forms.ModelChoiceField(queryset=Agent.objects.none())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #get parameter passed in views</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, *args, **kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        request = kwargs.pop(&#x27;request&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        agents = Agent.objects.filter(organization=request.user.userprofile)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #initialize the form</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(AssinAgentForm,self).__init__(*args,**kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.fields[&#x27;agent&#x27;].queryset = agents</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="filter-by-category">Filter by category<a class="hash-link" href="#filter-by-category" title="Direct link to heading">​</a></h2><p>將leads依照類別分類顯示，目前的model如下</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class Lead(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    first_name = models.CharField(max_length=20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    last_name = models.CharField(max_length=20)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    age = models.IntegerField(default=0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organization = models.ForeignKey(UserProfile,on_delete=models.CASCADE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    agent = models.ForeignKey(&quot;Agent&quot;,null=True,blank=True,on_delete = models.SET_NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    category = models.ForeignKey(&quot;Category&quot;,null=True,blank=True,on_delete = models.SET_NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#category of leads : New(initial), contacted, Converted, Unconverted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Category(models.Model):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    name = models.CharField(max_length=30)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    organization = models.ForeignKey(UserProfile,on_delete=models.CASCADE)   </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="有三種方法可以實現">有三種方法可以實現<a class="hash-link" href="#有三種方法可以實現" title="Direct link to heading">​</a></h4><p>前兩種基本上是長得像這樣子，<code>get_context_data(self,**kwargs):</code>，再對context做一些update</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">class CategoryDetailView(LoginRequiredMixin,DetailView):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    template_name = &#x27;leads/category_detail.html&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    context_object_name = &#x27;category&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_context_data(self,**kwargs):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context = super(CategoryDetailView,self).get_context_data(**kwargs)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        leads = ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        context.update({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &#x27;leads&#x27;:leads</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        })</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return context</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def get_queryset(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        user = self.request.user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        #initial query of lead in the organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if user.is_organizor:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            queryset = Category.objects.filter(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                organization = user.userprofile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                queryset = Category.objects.filter(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    organization = user.agent.organization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return queryset</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ol><li><p><code>get_object</code></p><p>此方法在DetailView中</p><p>[<strong>get_object</strong>]<!-- -->    <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/mixins-single-object/#django.views.generic.detail.SingleObjectMixin.get_object" target="_blank" rel="noopener noreferrer">https://docs.djangoproject.com/en/4.0/ref/class-based-views/mixins-single-object/#django.views.generic.detail.SingleObjectMixin.get_object</a> </p><p>，會回傳這個view所需要的單一物件，使用<code>queryset</code>或<code>get_queryset()</code>當作物件的來源，使用網址列所提供的引數作為查找目標。（翻譯得很爛，可以直接看文件!）</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">leads = Lead.objects.filter(category=self.get_object())</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>反向去搜尋foriegn key</p><p>因為model Category 是 model Lead的FK，所以可以用這樣的方法。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">leads = self.get_object().lead_set.all()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>另外也可以在models.py做些更動，在Lead中的category欄位加入新的field <code>related_name</code>（這個name用來告知連結兩model的關係）</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">category = models.ForeignKey(&quot;Category&quot;,related_name=&#x27;leads&#x27;,null=True,blank=True,on_delete = models.SET_NULL)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>因此在views.py就可以改成</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">leads = self.get_object().leads.all()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><strong>有了<code>related_name</code>可以直接在html中使用</strong></p></li></ol><p>​		前面兩種方法因為在views.py中已經過濾好要顯示的lead，所以在html中是長這樣子</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% for lead in leads %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;tr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;td class=&quot;px-4 py-3&quot;&gt;{{ lead.first_name }}&lt;/td&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;td class=&quot;px-4 py-3&quot;&gt;{{ lead.last_name }}&lt;/td&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/tr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>​	而因為剛剛在model中設定了<code>related_name = leads</code>，所以不需要在views中先<code>get_context_data()</code>，而是直接將html改成</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">{% for lead in category.leads.all %}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;tr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;td class=&quot;px-4 py-3&quot;&gt;{{ lead.first_name }}&lt;/td&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;td class=&quot;px-4 py-3&quot;&gt;{{ lead.last_name }}&lt;/td&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/tr&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{% endfor %}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="django-third-party-packages">Django Third party Packages<a class="hash-link" href="#django-third-party-packages" title="Direct link to heading">​</a></h2><p><a href="https://djangopackages.org/" target="_blank" rel="noopener noreferrer">https://djangopackages.org/</a></p><p>Use crispy form for this project.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="deployment">Deployment<a class="hash-link" href="#deployment" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="environment-variables">Environment Variables<a class="hash-link" href="#environment-variables" title="Direct link to heading">​</a></h3><p>用django-environ來管理設定的套件，原先的設定都在project/settings.py裡面，現在將設定抽離到程式之外，以便未來有設定需要更動時僅需調整這些設定就行了。</p><ol><li><p><code>$pip install django-environ</code></p><p>（記得每次新增套件就用<code>$pip freeze &gt; requirements.txt</code>來記錄）</p></li><li><p>新建<code>.env</code>在project的根目錄中</p><p>另外也創建一個<code>.template.env</code>之後會放在git repository上，因為我們不會想把secret_key放在網路上，所以只放模板。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DEBUG=True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECRET_KEY=&#x27;XXXXXXX&#x27;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>project/settings.py新增</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">import environ</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">env = environ.Env(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # set casting, default value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEBUG=(bool, False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">environ.Env.read_env()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DEBUG = env(&#x27;DEBUG&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECRET_KEY = env(&#x27;SECRET_KEY&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BASE_DIR = Path(__file__).resolve().parent.parent</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>其中，為了讓我們自己決定是否程式可以讀取.env，將</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">environ.Env.read_env()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>改成</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">READ_DOT_ENV_FILE = env.bool(&#x27;READ_DOT_ENV_FILE&#x27;,default=False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if READ_DOT_ENV_FILE:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environ.Env.read_env()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>當我們在terminal或佈署時的終端機輸入<code>export  READ_DOT_ENV_FILE=True</code>時，就可以去讀取.env，再進一步開始執行server。</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="set-up-postgresql">Set up Postgresql<a class="hash-link" href="#set-up-postgresql" title="Direct link to heading">​</a></h3><ol><li><p>安裝PostgreSQL</p><p>Ubuntu中官方套件已收錄，所以執行以下指令即可</p><ul><li><code>$sudo apt update</code></li><li><code>$apt-get install postgresql-12</code>（最新版）</li><li>相關操作<ul><li><code>$systemctl status postgresql.service</code>查看服務氣是否正常啟動</li><li>進入指令介面<code>$sudo -u postgres psql</code>（以預設管理權限使用者postgres操作）</li><li>離開<code>Ctrl</code>+<code>d</code>或<code>q</code></li><li>新增使用者<code>createuser User1</code></li><li>新增資料庫<code>createdb dbdemo</code></li></ul></li></ul></li><li><p>DB操作</p><ol><li>創建資料庫<code>CREATE DATABASE yehcrm;</code></li><li>創建使用者<code>CREATE USER yehcrmuser WITH PASSWORD &#x27;XXXX&#x27;;</code></li><li>給予權限<code>GRANT ALL PRIVILEGES ON DATABASE yehcrm TO yehcrmuser;</code></li></ol></li><li><p>更改.env 和 .template.env</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DEBUG=True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SECRET_KEY=&#x27;znogy$=ohkmfq@*0a+75t6!nkhpmto2ecuae)(l6n$%uzmn@tw&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_NAME=&quot;yehcrm&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># use &quot;&quot; or not is fine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_USER=yehcrmuser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PASSWORD=yehcrm1225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_HOST=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#leave blank means go defalt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DB_PORT=</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>** <strong><code>=</code>前後如有空格可能造成讀取失敗!!!!</strong></p></li><li><p>settings.py中的DATABASES</p><p>安裝套件<code>psycopg2</code> : <code>pip install psycopg2-binary</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">DATABASES = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;default&#x27;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;ENGINE&#x27;: &#x27;django.db.backends.postgresql_psycopg2&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;NAME&#x27;: env(&#x27;DB_NAME&#x27;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;USER&#x27;:env(&quot;DB_USER&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;PASSWORD&#x27;:env(&quot;PASSWORD&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;HOST&#x27;:env(&quot;DB_HOST&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;PORT&#x27;:env(&quot;DB_PORT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p><code>python manage.py migrate</code></p><p>因為換了資料庫，所以需要重新migrate</p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="whitenoise---static-files">Whitenoise -&gt; Static files<a class="hash-link" href="#whitenoise---static-files" title="Direct link to heading">​</a></h3><p><a href="http://whitenoise.evans.io/en/stable/" target="_blank" rel="noopener noreferrer">http://whitenoise.evans.io/en/stable/</a></p><ol><li><code>$pip install whitenoise</code></li><li>修改settings.py（根據文件）</li><li><code>$python manage.py collectstatic</code></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="digital-ocean">Digital Ocean<a class="hash-link" href="#digital-ocean" title="Direct link to heading">​</a></h3><ol><li><p>Add a new app</p></li><li><p>Build a DB</p></li><li><p>enter enviroment variable for the app</p></li><li><p><code>$pip install gunicorn</code></p></li><li><p>add security in settings.py</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">if not DEBUG:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_PROXY_SSL_HEADER = (&#x27;HTTP_X_FORWARDED_PROTO&#x27;, &#x27;https&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_SSL_REDIRECT = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SESSION_COOKIE_SECURE = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CSRF_COOKIE_SECURE = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_BROWSER_XSS_FILTER = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_CONTENT_TYPE_NOSNIFF = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_HSTS_SECONDS = 31536000  # 1 year</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_HSTS_INCLUDE_SUBDOMAINS = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SECURE_HSTS_PRELOAD = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    X_FRAME_OPTIONS = &quot;DENY&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ALLOWED_HOSTS = [&quot;*&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_BACKEND = &quot;django.core.mail.backends.smtp.EmailBackend&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_HOST = env(&quot;EMAIL_HOST&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_HOST_USER = env(&quot;EMAIL_HOST_USER&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_HOST_PASSWORD = env(&quot;EMAIL_HOST_PASSWORD&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_USE_TLS = True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EMAIL_PORT = env(&quot;EMAIL_PORT&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEFAULT_FROM_EMAIL = env(&quot;DEFAULT_FROM_EMAIL&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></li><li><p>new file runserver.sh</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">python manage.py collectstatic --no-input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">python manage.py migrate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gunicorn --worker-tmp-dir /dev/shm djcrm.wsgi</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>但這不能在terminal中執行，輸入<code>$chmod +x runserver.sh</code></p></li></ol><h3 class="anchor anchorWithStickyNavbar_mojV" id="mailgun">Mailgun<a class="hash-link" href="#mailgun" title="Direct link to heading">​</a></h3><p><a href="https://www.mailgun.com/" target="_blank" rel="noopener noreferrer">Transactional Email API Service For Developers | Mailgun</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/yehs1225/yehs1225.github.io/docs/Django/Build a CRM with Django.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/DataStructures/Tree"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tree</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Django/Django_GetStarted"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Django_GetStarted</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#建立app" class="table-of-contents__link toc-highlight">建立App</a></li><li><a href="#建立資料庫" class="table-of-contents__link toc-highlight">建立資料庫</a><ul><li><a href="#建立table" class="table-of-contents__link toc-highlight">建立table</a></li><li><a href="#連結兩table" class="table-of-contents__link toc-highlight">連結兩table</a></li><li><a href="#使用者table" class="table-of-contents__link toc-highlight">使用者table</a></li></ul></li><li><a href="#操作資料庫" class="table-of-contents__link toc-highlight">操作資料庫</a></li><li><a href="#管理者頁面設定" class="table-of-contents__link toc-highlight">管理者頁面設定</a></li><li><a href="#view" class="table-of-contents__link toc-highlight">View</a></li><li><a href="#url-namespaces" class="table-of-contents__link toc-highlight">URL Namespaces</a></li><li><a href="#forms" class="table-of-contents__link toc-highlight">Forms</a></li><li><a href="#model-form" class="table-of-contents__link toc-highlight">Model Form</a></li><li><a href="#update-view-form" class="table-of-contents__link toc-highlight">Update View （Form）</a></li><li><a href="#delete-viewform" class="table-of-contents__link toc-highlight">Delete View（form）</a></li><li><a href="#url-names" class="table-of-contents__link toc-highlight">URL Names</a></li><li><a href="#extending-templates" class="table-of-contents__link toc-highlight">Extending Templates</a></li><li><a href="#twailwindcss" class="table-of-contents__link toc-highlight">TwailwindCss</a></li><li><a href="#class-based-view" class="table-of-contents__link toc-highlight">Class Based View</a></li><li><a href="#set-static-files" class="table-of-contents__link toc-highlight">Set Static files</a></li><li><a href="#send-emails" class="table-of-contents__link toc-highlight">Send Emails</a></li><li><a href="#authentication" class="table-of-contents__link toc-highlight">Authentication</a></li><li><a href="#test" class="table-of-contents__link toc-highlight">Test</a></li><li><a href="#auth-permissions" class="table-of-contents__link toc-highlight">Auth Permissions</a></li><li><a href="#password" class="table-of-contents__link toc-highlight">Password</a></li><li><a href="#dynamic-choices" class="table-of-contents__link toc-highlight">Dynamic choices</a></li><li><a href="#filter-by-category" class="table-of-contents__link toc-highlight">Filter by category</a></li><li><a href="#django-third-party-packages" class="table-of-contents__link toc-highlight">Django Third party Packages</a></li><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a><ul><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a></li><li><a href="#set-up-postgresql" class="table-of-contents__link toc-highlight">Set up Postgresql</a></li><li><a href="#whitenoise---static-files" class="table-of-contents__link toc-highlight">Whitenoise -&gt; Static files</a></li><li><a href="#digital-ocean" class="table-of-contents__link toc-highlight">Digital Ocean</a></li><li><a href="#mailgun" class="table-of-contents__link toc-highlight">Mailgun</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Tzu Hsuan Yeh. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.507c9dbe.js"></script>
<script src="/assets/js/main.8f8dcb0d.js"></script>
</body>
</html>